local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local ServerScriptService = game:GetService("ServerScriptService")

-- ä½œæˆã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã‚€
-- â€»Rojoã®æ§‹é€ ã«åˆã‚ã›ã¦ãƒ‘ã‚¹ã¯é©å®œèª¿æ•´ã•ã‚Œã¾ã™ãŒã€é€šå¸¸ã¯ä»¥ä¸‹ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™
local GhostRecorder = require(ServerScriptService.Server.services.GhostRecorder)
local GhostPlayback = require(ServerScriptService.Server.services.GhostPlayback)

local ROOM_folder = workspace:WaitForChild("CurrentRoom")
local ENTRANCE_part = ROOM_folder:WaitForChild("Entrance")
local GHOST_template = ReplicatedStorage:WaitForChild("Ghost")

-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå‚åŠ ã—ãŸã‚‰ãƒ†ã‚¹ãƒˆé–‹å§‹
Players.PlayerAdded:Connect(function(player)
	player.CharacterAdded:Connect(function(character)
		print("ğŸ¥ éŒ²ç”»é–‹å§‹: 5ç§’é–“å‹•ã„ã¦ãã ã•ã„ï¼")

		-- 1. éŒ²ç”»é–‹å§‹
		GhostRecorder.StartRecording(player, ENTRANCE_part)

		-- 5ç§’å¾Œã«éŒ²ç”»åœæ­¢ï¼†å†ç”Ÿ
		task.wait(5)

		print("ğŸ›‘ éŒ²ç”»çµ‚äº† & å†ç”Ÿæº–å‚™")
		local recordedData = GhostRecorder.StopRecording(player)

		-- 2. ã‚´ãƒ¼ã‚¹ãƒˆã‚’ç”Ÿæˆ
		local ghost = GHOST_template:Clone()
		ghost.Parent = workspace
		-- ã‚´ãƒ¼ã‚¹ãƒˆã‚’åˆæœŸä½ç½®ï¼ˆè¨˜éŒ²ã®æœ€åˆã®ãƒ•ãƒ¬ãƒ¼ãƒ ï¼‰ã«ç§»å‹•ã•ã›ã‚‹å‡¦ç†ã‚’å…¥ã‚Œã‚‹ã¨ã‚ˆã‚Šä¸å¯§ã§ã™ãŒã€
		-- ã„ã£ãŸã‚“Playé–¢æ•°ã«ä»»ã›ã¾ã™ã€‚

		print("ğŸ‘» ã‚´ãƒ¼ã‚¹ãƒˆå†ç”Ÿé–‹å§‹")
		GhostPlayback.Play(ghost, recordedData, ENTRANCE_part)
	end)
end)
